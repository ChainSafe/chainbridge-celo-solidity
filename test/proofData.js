/**
 * Copyright 2020 ChainSafe Systems
 * SPDX-License-Identifier: LGPL-3.0-only
 */
const Ethers = require('ethers');

const rlp = require('rlp');
const { arrayify, hexlify } = Ethers.utils;

const blockHeaderRLP = '0xf9024aa0bdc9d5e9e9b5acf4e2f39006cfe37d0d233d0a4c5d85a1ff4b7f7e99eb451b4f947f290fc350ead2d6ab5244eb7846508f47a037f9a0a9fae2590c135d8754dbe21f1a218bb3720c6bd0ed28d0d6e70ac0af3fee1b2da0f97f613101d7199a042f6d347852bc0feeb3417eeb9d69f2e92b9016902d1e8ca0fb5f7bc425f745c03b9caa48b764f91fd6f8936eb70b8a4d181c634d5b1b8e1eb9010000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000200000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000822483831a2a768460d0be28b8a0d883010400846765746888676f312e31362e35856c696e757800000000000000f87ec0c080b8419a21bd387393ccd5cc667cdd596f9f16abe1300aba897ce213196f897a4014454cb2a008088876bf4f70251272211e761bf0f908d2e88799e0c23098ce4fc74800c3808080f301b0431e590056cfcebed179a626e56b7b9db2d9c39669a42e8f83a6afab51463f0aa4c5ca20a9aadba8454d94a73b05248080';
const blockHashPrefix = '0x05';
const blockHashSuffix = '0x02';
const blockHashBLSHints = '0x000000000000000000000000000000000104345ac1009414856c5124eb901145662ac300c62b15f9f2258252f7a38854b4b98d51d6a3e05be6ee88467e1233310000000000000000000000000000000000aa05eb56c47cd640ceb49b811137f5b3f816f23ac9fd952ccddfdcc265bfab6251cff2595c1fa49e1a37b981edccd0';
const blockHashSignature = '0x00000000000000000000000000000000005f9fdacc905d13f1c9fb618b356252761def51ce80715ee63abee248ba21e0a43cf5be554f842a41857259e28f6f9e00000000000000000000000000000000005c8cd1529cc35e2026e258831dfe539200c0b3b1bffa36e63d5b0e76bc15191b8540cbbf828f63c40587cc80dedd74';
const aggregatePublicKey = '0x0000000000000000000000000000000001518051317d517da60d53eea68934775f1fc490913d983a4c08f2bb0dba998de0043981b002f275dfb0f91ede06b5aa0000000000000000000000000000000000c480c02c4ed43bed3ee61cf14766035f54022c3cad5bc8227f2adb8ee0a13bf968a4071baf4386762dd7d7b8fd0d8600000000000000000000000000000000002f95dc47ed1188c0cc5762cf3fe3de3cbd0584eedcda9581d78dbc44dbbbc8f773003f3d024c94a04b099158d677bf0000000000000000000000000000000000eca490fa6b49e659f7e143bf06e230b6417cd7caaa65ae2e9b6a610b84559e9244879348c1a9ac06259f6fdba605e5';
const blockHash = Ethers.utils.keccak256(arrayify(blockHeaderRLP));

const value = '0xf91e88038504a817c800836691b78080808080b91e2e608060405234801561001057600080fd5b50611e0e806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c80637bb1ed4114610030575b600080fd5b6102636004803603608081101561004657600080fd5b810190602081018135600160201b81111561006057600080fd5b82018360208201111561007257600080fd5b803590602001918460018302840111600160201b8311171561009357600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b8111156100e557600080fd5b8201836020820111156100f757600080fd5b803590602001918460018302840111600160201b8311171561011857600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b81111561016a57600080fd5b82018360208201111561017c57600080fd5b803590602001918460018302840111600160201b8311171561019d57600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b8111156101ef57600080fd5b82018360208201111561020157600080fd5b803590602001918460018302840111600160201b8311171561022257600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550610277945050505050565b604080519115158252519081900360200190f35b600061028585858585610290565b90505b949350505050565b600061029a611bfb565b6102ac6102a687610385565b86610502565b90506102b6611c20565b6102c184600061054a565b90506102cb611bfb565b6102d6866000610595565b60408051600280825260608281019093529293509091816020015b6102f9611c40565b8152602001906001900390816102f1579050509050604051806040016040528083815260200161032761065d565b8152508160008151811061033757fe5b60200260200101819052506040518060400160405280858152602001848152508160018151811061036457fe5b6020026020010181905250610378816107b4565b9998505050505050505050565b606060006103a9602082808083816040818381672aa63337b93c37b360c11b6107d6565b905060006103ce60208280808360016040838381672aa63337b93c37b360c11b6107d6565b905060006103f360208260018082806040818080672aa63337b93c37b360c11b6107d6565b905060606104118260405180602001604052806000815250886108c8565b905061042d8460405180602001604052806000815250836108c8565b6104478460405180602001604052806000815250846108c8565b6040516020018083805190602001908083835b602083106104795780518252601f19909201916020918201910161045a565b51815160209384036101000a600019018019909216911617905285519190930192850191508083835b602083106104c15780518252601f1990920191602091820191016104a2565b6001836020036101000a038019825116818451168082178552505050505050905001925050506040516020818303038152906040529450505050505b919050565b61050a611bfb565b6000610514611c60565b61051d8561099d565b92509050610541816105308660006109ea565b61053b8760406109ea565b85610a52565b95945050505050565b610552611c20565b61055a611bfb565b6105648484610a95565b905061056e611bfb565b61057b8585608001610a95565b604080518082019091529283526020830152509392505050565b61059d611bfb565b60006105cf8385510360006105bc600088610ac690919063ffffffff16565b62ffffff1916919063ffffffff610ae116565b90506105ea62ffffff1982166000602063ffffffff610b1016565b82515261060562ffffff19821660208063ffffffff610b1016565b825160209081019190915261062a9062ffffff1983169060409063ffffffff610b1016565b6020808401519190915261064e9062ffffff1983169060609063ffffffff610b1016565b60208084015101525092915050565b610665611c20565b61066d611bfb565b50604080516080810182526f018480be71c785fec89630a2a3841d018183019081527fc565f071203e50317ea501f557db6b9b71889f52bb53540274e3e48f7c0051966060830152815281518083019092526eea6040e700403170dc5a51b1b140d582527f532777ee6651cecbe7223ece0799c9de5cf89984bff76fe6b26bfefa6ea16afe602083810191909152810191909152610709611bfb565b50604080516080810182526f01452cdfba80a16eecda9254a0ee59868183019081527f3c1eec808c4079363a9a9facc1d675fb243bd4bbc27383d19474b6bbf602b22260608301528152815180830183526eb623a64541bbd227e6681d5786d89081527fb833c846c39bf79dfa8fb214eb26433dd491a504d1add8f4ab66f22e7a14706e60208281019190915280830191909152825180840190935292825291810191909152905090565b600080825161d6d80261fde80190506107cf8360e383610b31565b9392505050565b600060208b60ff16111561081b5760405162461bcd60e51b8152600401808060200182810382526035815260200180611c996035913960400191505060405180910390fd5b6108278160008e610ede565b90506108358160018d610ede565b90506108438160028c610ede565b90506108518160038b610ede565b905061085f8160048a610f38565b905061086d81600889610f38565b905061087b81600c88610f99565b905061088981600e87610ede565b905061089781600f86610ede565b60c083901c6fffffffffffffffff0000000000000000608086901c169091171790509b9a5050505050505050505050565b815160609060ff60f086901c16146109115760405162461bcd60e51b8152600401808060200182810382526054815260200180611d506054913960600191505060405180910390fd5b606084836040516020018083815260200182805190602001908083835b6020831061094d5780518252601f19909201916020918201910161092e565b6001836020036101000a0380198251168184511680821785525050505050509050019250505060405160208183030381529060405290506105418160108760006020811061099757fe5b1a610fc2565b6109a5611c60565b6000806000806109b6866000611070565b60408051808201909152600160781b607883901b169093018352602083019190915290955060021615159350505050915091565b6109f2611c60565b6000610a118385510360006105bc600088610ac690919063ffffffff16565b9050610a2c62ffffff1982166000602063ffffffff610b1016565b8252610a4662ffffff19821660208063ffffffff610b1016565b60208301525092915050565b610a5a611bfb565b610a62611bfb565b610a6e86868686611111565b9050610a78611bfb565b610a8a82640170b5d443605c1b6112db565b979650505050505050565b610a9d611bfb565b610aa5611c60565b610aaf84846112f8565b9050610ab9611c60565b61057b85856040016112f8565b81516000906020840161054164ffffffffff85168284611328565b600061028884610b0985610af488611368565b6001600160601b03169063ffffffff61137716565b85856113d4565b60008160200360080260ff16610b27858585611455565b901c949350505050565b60008084519050606081600c02604051908082528060200260200182016040528015610b67578160200160208202803683370190505b50905060005b82811015610e6257600081600c029050878281518110610b8957fe5b60209081029190910101515151518351849083908110610ba557fe5b602002602001018181525050878281518110610bbd57fe5b6020026020010151600001516000015160200151838260010181518110610be057fe5b602002602001018181525050878281518110610bf857fe5b6020026020010151600001516020015160000151838260020181518110610c1b57fe5b602002602001018181525050878281518110610c3357fe5b6020026020010151600001516020015160200151838260030181518110610c5657fe5b602002602001018181525050878281518110610c6e57fe5b602002602001015160200151600001516000015160000151838260040181518110610c9557fe5b602002602001018181525050878281518110610cad57fe5b602002602001015160200151600001516000015160200151838260050181518110610cd457fe5b602002602001018181525050878281518110610cec57fe5b602002602001015160200151600001516020015160000151838260060181518110610d1357fe5b602002602001018181525050878281518110610d2b57fe5b602002602001015160200151600001516020015160200151838260070181518110610d5257fe5b602002602001018181525050878281518110610d6a57fe5b602002602001015160200151602001516000015160000151838260080181518110610d9157fe5b602002602001018181525050878281518110610da957fe5b602002602001015160200151602001516000015160200151838260090181518110610dd057fe5b602002602001018181525050878281518110610de857fe5b6020026020010151602001516020015160200151600001518382600a0181518110610e0f57fe5b602002602001018181525050878281518110610e2757fe5b6020026020010151602001516020015160200151602001518382600b0181518110610e4e57fe5b602090810291909101015250600101610b6d565b50600060206040518461018002602085018989fa90506040515193508160405280610ed4576040805162461bcd60e51b815260206004820152601960248201527f70616972696e6720707265636f6d70696c65206661696c656400000000000000604482015290519081900360640190fd5b5050509392505050565b6000601f8360ff161115610f235760405162461bcd60e51b8152600401808060200182810382526027815260200180611d296027913960400191505060405180910390fd5b5060ff908116601f92909203600802161b1790565b6000610f4b848463ffffffff8516610ede565b9350610f65848460010160088563ffffffff16901c610ede565b9350610f7f848460020160108563ffffffff16901c610ede565b9350610288848460030160188563ffffffff16901c610ede565b6000610faa848461ffff8516610ede565b9350610288848460010160088561ffff16901c610ede565b6060600060e290506060836040519080825280601f01601f191660200182016040528015610ff7576020820181803683370190505b509050600086519050600086885282516020840160018401601f8b01876107d05a03fa905081885280611064576040805162461bcd60e51b815260206004820152601060248201526f1ad958d8d85acd4c4c8819985a5b195960821b604482015290519081900360640190fd5b50909695505050505050565b600080808080805b60208110156110ac576000888289018151811061109157fe5b016020015160f81c600883021b929092019150600101611078565b5060005b600f8110156110e757600088828901602001815181106110cc57fe5b016020015160f81c600883021b9390930192506001016110b0565b5081818888602f01815181106110f957fe5b0160200151919650945060f81c925050509250925092565b611119611bfb565b611121611c60565b50604080518082019091526f01ae3a4617c510eac63b05c06ca1493b81527f1a22d9f300f5138f1ef3622fba094800170b5d44300000008508c00000000001602082015261116d611c60565b5060408051808201909152600081526001602082015261118b611c60565b6111a061119a896003866115be565b83611694565b90506111aa611c60565b6111b6886002866115be565b90506111c0611c60565b6111cc886002876115be565b90506111d882846116f4565b611217576040805162461bcd60e51b815260206004820152600b60248201526a1e4c481b9bdd081cdc5c9d60aa1b604482015290519081900360640190fd5b61122181846116f4565b611260576040805162461bcd60e51b815260206004820152600b60248201526a1e4c881b9bdd081cdc5c9d60aa1b604482015290519081900360640190fd5b61126a8989611711565b6112ad576040805162461bcd60e51b815260206004820152600f60248201526e1e4c481b9bdd0819dc99585d195cdd608a1b604482015290519081900360640190fd5b60405180604001604052808b8152602001886112c957896112cb565b8a5b90529a9950505050505050505050565b6112e3611bfb565b6107cf838360e861c35063ffffffff61173916565b611300611c60565b611308611c60565b5060408051808201909152600080825260208201526107cf848483611808565b60008061133b848463ffffffff61182016565b905060405181111561134b575060005b8061135d5762ffffff199150506107cf565b61054185858561187e565b60181c6001600160601b031690565b6000828211156113ce576040805162461bcd60e51b815260206004820152601d60248201527f556e646572666c6f7720647572696e67207375627472616374696f6e2e000000604482015290519081900360640190fd5b50900390565b6000806113e086611891565b6001600160601b031690506113f4866118a0565b61141485611408848963ffffffff61182016565b9063ffffffff61182016565b11156114275762ffffff19915050610288565b611437818663ffffffff61182016565b905061144b8364ffffffffff168286611328565b9695505050505050565b600060ff8216611467575060006107cf565b61147084611368565b6001600160601b031661148c8460ff851663ffffffff61182016565b1115611547576114c361149e85611891565b6001600160601b03166114b086611368565b6001600160601b0316858560ff166118c5565b60405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561150c5781810151838201526020016114f4565b50505050905090810190601f1680156115395780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b60208260ff16111561158a5760405162461bcd60e51b815260040180806020018281038252603a815260200180611cef603a913960400191505060405180910390fd5b60088202600061159986611891565b6001600160601b0316905060006115af836119b8565b91909501511695945050505050565b6115c6611c60565b83516020808601518451918501516040805161010080825261012082019092529293926060916020820181803683375050604080518181526060808201835293945091506020820181803683370190505090506000806040602085015260206040850152604060608501528760808501528660a08501528a60c08501528560e0850152846101008501526040602084016101006020870160055afa80801561002b57505050602080830151604093840151845180860190955290845290830152509998505050505050505050565b61169c611c60565b602080830151908401519081019060009082108015906116c0575083602001518210155b6116cb5760016116ce565b60005b935194516040805180820190915260ff9095169501949094018352602083015250919050565b805182516000911480156107cf5750506020908101519101511490565b8051825160009110806107cf5750815183511480156107cf5750506020908101519101511190565b611741611bfb565b611749611c7a565b85515181528551602090810151818301528087018051516040840152510151606082015260808082018690526000908260a0818888fa905081604052806117d7576040805162461bcd60e51b815260206004820152601860248201527f6731206d756c20707265636f6d70696c65206661696c65640000000000000000604482015290519081900360640190fd5b5080518251526020808201518351820152604082015183820180519190915260609092015191510152949350505050565b60209290910182810151604090910151908252910152565b81810182811015611878576040805162461bcd60e51b815260206004820152601960248201527f4f766572666c6f7720647572696e67206164646974696f6e2e00000000000000604482015290519081900360640190fd5b92915050565b606092831b9190911790911b1760181b90565b60781c6001600160601b031690565b60006118ab82611368565b6118b483611891565b016001600160601b03169050919050565b606060006118d2866119c7565b91505060006118e0866119c7565b91505060006118ee866119c7565b91505060006118fc866119c7565b915050838383836040516020018080611da4603591396001600160d01b031960d087811b821660358401526e040eed2e8d040d8cadccee8d04060f608b1b603b84015286901b16604a8201526050016021611cce82396001600160d01b031960d094851b811660218301526e040eed2e8d040d8cadccee8d04060f608b1b60278301529290931b909116603683015250601760f91b603c82015260408051601d818403018152603d90920190529b9a5050505050505050505050565b600160ff1b6000199091011d90565b600080601f5b600f8160ff161115611a115760ff600882021684901c6119ec81611a5f565b61ffff16841793508160ff16601014611a0757601084901b93505b50600019016119cd565b50600f5b60ff8160ff161015611a595760ff600882021684901c611a3481611a5f565b61ffff16831792508160ff16600014611a4f57601083901b92505b5060001901611a15565b50915091565b6000611a7160048360ff16901c611a8f565b60ff161760081b62ffff0016611a8682611a8f565b60ff1617919050565b600060f08083179060ff82161415611aab5760309150506104fd565b8060ff1660f11415611ac15760319150506104fd565b8060ff1660f21415611ad75760329150506104fd565b8060ff1660f31415611aed5760339150506104fd565b8060ff1660f41415611b035760349150506104fd565b8060ff1660f51415611b195760359150506104fd565b8060ff1660f61415611b2f5760369150506104fd565b8060ff1660f71415611b455760379150506104fd565b8060ff1660f81415611b5b5760389150506104fd565b8060ff1660f91415611b715760399150506104fd565b8060ff1660fa1415611b875760619150506104fd565b8060ff1660fb1415611b9d5760629150506104fd565b8060ff1660fc1415611bb35760639150506104fd565b8060ff1660fd1415611bc95760649150506104fd565b8060ff1660fe1415611bdf5760659150506104fd565b8060ff1660ff1415611bf55760669150506104fd565b50919050565b6040518060400160405280611c0e611c60565b8152602001611c1b611c60565b905290565b6040518060400160405280611c33611bfb565b8152602001611c1b611bfb565b6040518060400160405280611c53611bfb565b8152602001611c1b611c20565b604051806040016040528060008152602001600081525090565b6040518060a00160405280600590602082028036833750919291505056fe43495032304c69622f637265617465436f6e666967202d2d206b65794c656e677468206d757374206265203332206f72206c6573732e20417474656d7074656420746f20696e646578206174206f666673657420307854797065644d656d566965772f696e646578202d20417474656d7074656420746f20696e646578206d6f7265207468616e20333220627974657343495032304c69622f77726974655538202d2d206f7574206f6620626f756e647320777269746543495032304c69622f626c616b65327357697468436f6e666967202d2050726f7669646564206b6579206c656e67746820646f6573206e6f74206d61746368206b6579206c656e67746820696e20636f6e66696754797065644d656d566965772f696e646578202d204f76657272616e2074686520766965772e20536c696365206973206174203078a264697066735822122033a54cef9b1f1d70db37d312fcdb00e9f3687858b772a6870fe09489a844849164736f6c63430006040033840115ae13a02ddaa98df891fd82a7f0766d2a72d73cd0583d01b7f92abf37b495b06c2efb85a037bd0a6605d32e3af5d1b3852ee2d6d6477159131fca8ca7abe8cc264fa1a18d';
const leafRoot = [ arrayify('0x2080'), arrayify(value) ];

const transactionMerkleKey = '0x0800';
const transactionMerkleNodes = hexlify(rlp.encode([leafRoot]));

const preimagePart = blockHash.slice(2) + transactionMerkleKey.slice(2) + aggregatePublicKey.slice(2);

module.exports = {
    blockHeaderRLP,
    blockHashPrefix,
    blockHashSuffix,
    blockHashBLSHints,
    blockHashSignature,
    aggregatePublicKey,
    transactionMerkleKey,
    transactionMerkleNodes,
    preimagePart,
    blockHash,
};
